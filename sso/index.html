<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #6200ea;
            --bg-color: #f3f4f6;
            --panel-width: 340px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            height: 100vh;
            color: #333;
        }

        /* ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls {
            width: var(--panel-width);
            background: white;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .control-group { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .control-group:last-child { border-bottom: none; }
        
        h2 { font-size: 1.2rem; margin-top: 0; color: var(--primary-color); }
        h3 { font-size: 0.9rem; color: #666; margin-bottom: 8px; }

        label { display: block; margin-bottom: 5px; font-size: 0.85rem; font-weight: bold; }
        input[type="text"], input[type="file"], select {
            width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;
        }
        input[type="color"] { width: 100%; height: 40px; padding: 0; border: none; cursor: pointer; }
        input[type="range"] { width: 100%; }

        button.btn-download {
            background-color: #ff0000; /* ìœ íŠœë¸Œ ë ˆë“œ */
            color: white;
            border: none;
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 10px;
        }
        button.btn-download:hover { background-color: #cc0000; }

        /* ì˜¤ë¥¸ìª½ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ */
        .preview-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #333;
            padding: 20px;
            overflow: hidden;
        }

        /* ì¸ë„¤ì¼ ìº”ë²„ìŠ¤ (16:9 ë¹„ìœ¨ ê³ ì •) */
        #thumbnail-canvas {
            width: 1280px;
            height: 720px;
            background-color: #000;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            /* í™”ë©´ì— ë§ê²Œ ì¶•ì†Œí•´ì„œ ë³´ì—¬ì£¼ê¸° */
            transform-origin: center center;
            user-select: none;
        }

        #bg-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0; left: 0;
            opacity: 1;
        }

        /* í…ìŠ¤íŠ¸ ìš”ì†Œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .draggable-text {
            position: absolute;
            font-family: 'Black Han Sans', sans-serif;
            line-height: 1.2;
            cursor: move;
            white-space: pre-wrap;
            text-align: center;
            /* ê°•ë ¥í•œ ì™¸ê³½ì„  íš¨ê³¼ (CSS Shadow Trick) */
            text-shadow: 
                3px 3px 0 #000, -1px -1px 0 #000, 
                1px -1px 0 #000, -1px 1px 0 #000, 
                1px 1px 0 #000;
        }
        
        .draggable-text:hover {
            outline: 2px dashed rgba(255, 255, 255, 0.5);
        }

        /* ê¸°ë³¸ í…ìŠ¤íŠ¸ í”„ë¦¬ì…‹ */
        #text-main {
            top: 20%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: #ffff00; /* ë…¸ë€ìƒ‰ ê°•ì¡° */
            z-index: 2;
        }

        #text-sub {
            top: 75%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            color: #ffffff;
            background: rgba(204, 0, 0, 0.9); /* ë¹¨ê°„ ë°°ê²½ ë°•ìŠ¤ */
            padding: 10px 30px;
            border-radius: 10px;
            box-shadow: 5px 5px 0px #000;
            z-index: 2;
        }

        /* ì˜¤ë²„ë ˆì´ (ë°°ê²½ ì–´ë‘¡ê²Œ) */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black;
            opacity: 0.2;
            pointer-events: none;
            z-index: 1;
        }

        .guide-text {
            color: #888;
            font-size: 0.8rem;
            margin-top: 5px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="controls">
        <h2>ğŸ¬ ì¸ë„¤ì¼ ë©”ì´ì»¤</h2>
        
        <div class="control-group">
            <h3>1. ë°°ê²½ ì´ë¯¸ì§€</h3>
            <input type="file" id="img-upload" accept="image/*">
            <label>ë°°ê²½ ì–´ë‘¡ê¸° (ê¸€ì ê°•ì¡°)</label>
            <input type="range" id="overlay-range" min="0" max="0.8" step="0.1" value="0.2">
        </div>

        <div class="control-group">
            <h3>2. ë©”ì¸ íƒ€ì´í‹€ (í° ê¸€ì”¨)</h3>
            <input type="text" id="input-main" value="ì¶©ê²©! ì´ê²ƒë§Œ ì•Œë©´ ë">
            <div style="display:flex; gap:5px;">
                <div style="flex:1;">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="color-main" value="#ffff00">
                </div>
                <div style="flex:1;">
                    <label>í¬ê¸°</label>
                    <input type="number" id="size-main" value="100">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>3. ì„œë¸Œ íƒ€ì´í‹€ (ë°•ìŠ¤ ê¸€ì”¨)</h3>
            <input type="text" id="input-sub" value="ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”">
            <div style="display:flex; gap:5px;">
                <div style="flex:1;">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="color-sub" value="#ffffff">
                </div>
                <div style="flex:1;">
                    <label>ë°°ê²½ìƒ‰</label>
                    <input type="color" id="bg-color-sub" value="#cc0000">
                </div>
            </div>
        </div>

        <button class="btn-download" onclick="downloadThumbnail()">ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ (JPG)</button>
        <p class="guide-text">*ì˜¤ë¥¸ìª½ í™”ë©´ì˜ ê¸€ìë¥¼ ë“œë˜ê·¸í•´ì„œ ìœ„ì¹˜ë¥¼ ì˜®ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="preview-area">
        <div id="thumbnail-canvas">
            <img id="bg-image" src="" alt="" style="display:none;">
            <div id="overlay"></div>
            
            <div id="text-main" class="draggable-text">ì¶©ê²©! ì´ê²ƒë§Œ ì•Œë©´ ë</div>
            <div id="text-sub" class="draggable-text">ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”</div>
        </div>
    </div>

    <script>
        // ìš”ì†Œ ì„ íƒ
        const canvas = document.getElementById('thumbnail-canvas');
        const bgImage = document.getElementById('bg-image');
        const imgUpload = document.getElementById('img-upload');
        const overlay = document.getElementById('overlay');
        const overlayRange = document.getElementById('overlay-range');

        // 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        imgUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    bgImage.src = event.target.result;
                    bgImage.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        // 2. ì˜¤ë²„ë ˆì´ ì¡°ì ˆ
        overlayRange.addEventListener('input', (e) => {
            overlay.style.opacity = e.target.value;
        });

        // 3. í…ìŠ¤íŠ¸ ì‹¤ì‹œê°„ ìˆ˜ì • í•¨ìˆ˜
        function bindTextControl(inputId, textId, colorId, sizeId, bgId) {
            const input = document.getElementById(inputId);
            const textElement = document.getElementById(textId);
            const colorInput = document.getElementById(colorId);
            
            // í…ìŠ¤íŠ¸ ë‚´ìš© ë³€ê²½
            input.addEventListener('input', () => textElement.innerText = input.value);
            
            // ìƒ‰ìƒ ë³€ê²½
            if(colorInput) {
                colorInput.addEventListener('input', () => textElement.style.color = colorInput.value);
            }

            // í¬ê¸° ë³€ê²½ (ë©”ì¸ íƒ€ì´í‹€ìš©)
            if(sizeId) {
                const sizeInput = document.getElementById(sizeId);
                sizeInput.addEventListener('input', () => textElement.style.fontSize = sizeInput.value + 'px');
            }

            // ë°°ê²½ìƒ‰ ë³€ê²½ (ì„œë¸Œ íƒ€ì´í‹€ìš©)
            if(bgId) {
                const bgInput = document.getElementById(bgId);
                bgInput.addEventListener('input', () => textElement.style.backgroundColor = bgInput.value);
            }
        }

        bindTextControl('input-main', 'text-main', 'color-main', 'size-main', null);
        bindTextControl('input-sub', 'text-sub', 'color-sub', null, 'bg-color-sub');

        // 4. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ (ë§ˆìš°ìŠ¤)
        let isDragging = false;
        let currentElement = null;
        let offsetX, offsetY;

        document.querySelectorAll('.draggable-text').forEach(el => {
            el.addEventListener('mousedown', (e) => {
                isDragging = true;
                currentElement = el;
                // í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì™€ ìš”ì†Œ ìœ„ì¹˜ì˜ ì°¨ì´ ê³„ì‚°
                offsetX = e.clientX - el.getBoundingClientRect().left;
                offsetY = e.clientY - el.getBoundingClientRect().top;
                el.style.cursor = 'grabbing';
            });
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !currentElement) return;
            
            // ìº”ë²„ìŠ¤ ê¸°ì¤€ ì¢Œí‘œ ê³„ì‚° (transform scale ê³ ë ¤í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”)
            // ìº”ë²„ìŠ¤ê°€ í™”ë©´ ì¤‘ì•™ì— ìˆìœ¼ë¯€ë¡œ clientX ì²˜ë¦¬ê°€ ê¹Œë‹¤ë¡œì›€.
            // ëŒ€ì‹  offsetParent ê¸°ì¤€ìœ¼ë¡œ % ë˜ëŠ” í”½ì…€ ì´ë™ ì²˜ë¦¬
            
            // ì‰¬ìš´ ë°©ë²•: ìº”ë²„ìŠ¤ ë‚´ë¶€ ì¢Œí‘œê³„ë¡œ ë³€í™˜
            const canvasRect = canvas.getBoundingClientRect();
            const scaleX = 1280 / canvasRect.width;
            const scaleY = 720 / canvasRect.height;

            let newX = (e.clientX - canvasRect.left - offsetX) * scaleX;
            let newY = (e.clientY - canvasRect.top - offsetY) * scaleY;

            // transform translate ì œê±°í•˜ê³  left/topìœ¼ë¡œë§Œ ì œì–´í•˜ê¸° ìœ„í•´ ì´ˆê¸°í™”
            currentElement.style.transform = 'none';
            currentElement.style.left = newX + 'px';
            currentElement.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            if (currentElement) currentElement.style.cursor = 'move';
            currentElement = null;
        });

        // 5. í™”ë©´ í¬ê¸°ì— ë§ì¶° ë¯¸ë¦¬ë³´ê¸° ì¶•ì†Œ (ë°˜ì‘í˜•)
        function resizePreview() {
            const container = document.querySelector('.preview-area');
            const containerWidth = container.clientWidth - 40;
            const containerHeight = container.clientHeight - 40;
            const scale = Math.min(containerWidth / 1280, containerHeight / 720);
            
            canvas.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizePreview);
        resizePreview(); // ì´ˆê¸° ì‹¤í–‰

        // 6. ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
        function downloadThumbnail() {
            // html2canvasë¥¼ ì‚¬ìš©í•˜ì—¬ ìº¡ì²˜
            html2canvas(canvas, {
                width: 1280,
                height: 720,
                scale: 1, // ì›ë³¸ í•´ìƒë„ ìœ ì§€
                backgroundColor: null,
                useCORS: true // ë¡œì»¬ ì´ë¯¸ì§€ ì´ìŠˆ ë°©ì§€ ë…¸ë ¥
            }).then(capturedCanvas => {
                const link = document.createElement('a');
                link.download = 'youtube_thumbnail.jpg';
                link.href = capturedCanvas.toDataURL('image/jpeg', 0.9);
                link.click();
            });
        }
    </script>
</body>
</html>
