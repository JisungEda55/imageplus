<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ V2 (Mobile)</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@500;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #FF0000;
            --bg: #f0f2f5;
            --canvas-w: 1280px;
            --canvas-h: 720px;
        }

        * { box-sizing: border-box; touch-action: manipulation; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        /* ë ˆì´ì•„ì›ƒ êµ¬ì¡° */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* 1. ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ (ìƒë‹¨) */
        .preview-zone {
            flex: 0 0 auto;
            background-color: #222;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* 2. ì»¨íŠ¸ë¡¤ ì˜ì—­ (í•˜ë‹¨, ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */
        .control-zone {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
            padding-bottom: 50px; /* í•˜ë‹¨ ì—¬ë°± */
        }

        /* ì¸ë„¤ì¼ ì‘ì—… ê³µê°„ (ì ˆëŒ€ í¬ê¸° 1280x720) */
        #workspace {
            width: var(--canvas-w);
            height: var(--canvas-h);
            background-color: #000;
            position: relative;
            overflow: hidden;
            transform-origin: top center; /* ì¶•ì†Œ ì‹œ ê¸°ì¤€ì  */
            flex-shrink: 0;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        #bg-layer {
            width: 100%; height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0; left: 0;
        }
        
        #overlay-layer {
            width: 100%; height: 100%;
            position: absolute;
            background: black;
            opacity: 0.2;
            pointer-events: none;
        }

        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .move-text {
            position: absolute;
            font-family: 'Black Han Sans', sans-serif;
            white-space: pre-wrap;
            text-align: center;
            cursor: move;
            line-height: 1.1;
            user-select: none;
            /* ëª¨ë°”ì¼ í„°ì¹˜ ì‹œ í•˜ì´ë¼ì´íŠ¸ ë°©ì§€ */
            -webkit-tap-highlight-color: transparent; 
            /* í…ìŠ¤íŠ¸ ì™¸ê³½ì„  (ê°€ë…ì„±) */
            text-shadow: 4px 4px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
        }

        .move-text.active {
            outline: 4px dashed #fff;
        }

        /* ì»¨íŠ¸ë¡¤ UI ìŠ¤íƒ€ì¼ */
        h2 { margin: 0 0 15px 0; font-size: 1.2rem; color: #333; }
        
        .input-group {
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #eee;
        }
        
        .label-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; color: #555; }
        
        input[type="text"] {
            width: 100%; padding: 12px; font-size: 1rem; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px;
        }
        
        .tool-row { display: flex; gap: 10px; }
        .tool-item { flex: 1; display: flex; flex-direction: column; }
        .tool-item label { font-size: 0.8rem; margin-bottom: 4px; color: #888; }
        input[type="color"] { width: 100%; height: 40px; border: none; padding: 0; cursor: pointer; border-radius: 4px; }
        input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        input[type="range"] { width: 100%; }

        /* íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ ì»¤ìŠ¤í…€ */
        .file-input-wrapper {
            position: relative;
            margin-bottom: 15px;
        }
        .file-input-wrapper input {
            position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer;
        }
        .custom-file-btn {
            display: block; width: 100%; padding: 12px;
            background: #333; color: white; text-align: center;
            border-radius: 8px; font-weight: bold;
        }

        .btn-save {
            width: 100%; padding: 16px;
            background-color: var(--primary);
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: 900;
            box-shadow: 0 4px 6px rgba(255,0,0,0.3);
            cursor: pointer;
        }
        .btn-save:active { transform: scale(0.98); }

        /* PC í™”ë©´ ëŒ€ì‘ (ê°€ë¡œ ë°°ì¹˜) */
        @media (min-width: 1024px) {
            .app-container { flex-direction: row; }
            .preview-zone { flex: 1; height: 100vh; order: 2; }
            .control-zone { width: 400px; height: 100vh; order: 1; border-right: 1px solid #ddd; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="preview-zone" id="preview-container">
        <div id="workspace">
            <img id="bg-layer" src="" alt="" style="display:none;">
            <div id="overlay-layer"></div>
            
            <div id="t1" class="move-text" style="top:20%; left:50%; transform:translate(-50%, -50%); font-size:110px; color:#FFE400; z-index:2;">
                ì–´ê·¸ë¡œ ì œëª©<br>ì—¬ê¸° ì…ë ¥
            </div>
            
            <div id="t2" class="move-text" style="top:75%; left:50%; transform:translate(-50%, -50%); font-size:60px; color:#fff; background:rgba(200,0,0,1); padding:10px 40px; border-radius:15px; z-index:2;">
                í•µì‹¬ ë‚´ìš© ìš”ì•½
            </div>
        </div>
    </div>

    <div class="control-zone">
        <h2>ğŸ¨ ì¸ë„¤ì¼ í¸ì§‘ê¸°</h2>
        
        <div class="input-group">
            <div class="label-row"><span>1. ì‚¬ì§„ ì—…ë¡œë“œ</span></div>
            <div class="file-input-wrapper">
                <button class="custom-file-btn">ğŸ“· ê°¤ëŸ¬ë¦¬ì—ì„œ ì‚¬ì§„ ì„ íƒ</button>
                <input type="file" id="inp-img" accept="image/*">
            </div>
            <div class="label-row"><span>ë°°ê²½ ì–´ë‘¡ê¸° (ê¸€ì ì˜ë³´ì´ê²Œ)</span></div>
            <input type="range" id="inp-dim" min="0" max="0.8" step="0.1" value="0.2">
        </div>

        <div class="input-group">
            <div class="label-row"><span>2. í° ì œëª© (ë…¸ë€ìƒ‰)</span></div>
            <input type="text" id="inp-t1" value="ì–´ê·¸ë¡œ ì œëª©&#10;ì—¬ê¸° ì…ë ¥"> <div class="tool-row">
                <div class="tool-item">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="col-t1" value="#FFE400">
                </div>
                <div class="tool-item">
                    <label>í¬ê¸°</label>
                    <input type="number" id="siz-t1" value="110">
                </div>
            </div>
        </div>

        <div class="input-group">
            <div class="label-row"><span>3. ê°•ì¡° ë°•ìŠ¤ (ë¹¨ê°„ìƒ‰)</span></div>
            <input type="text" id="inp-t2" value="í•µì‹¬ ë‚´ìš© ìš”ì•½">
            <div class="tool-row">
                <div class="tool-item">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="col-t2" value="#ffffff">
                </div>
                <div class="tool-item">
                    <label>ë°°ê²½ìƒ‰</label>
                    <input type="color" id="bg-t2" value="#c80000">
                </div>
            </div>
        </div>

        <button class="btn-save" onclick="saveImage()">ì´ë¯¸ì§€ ì €ì¥í•˜ê¸° (ë‹¤ìš´ë¡œë“œ)</button>
        <p style="text-align:center; color:#888; font-size:0.8rem; margin-top:10px;">
            *í™”ë©´ì˜ ê¸€ìë¥¼ ì†ê°€ë½ìœ¼ë¡œ ë“œë˜ê·¸í•´ë³´ì„¸ìš”!
        </p>
    </div>
</div>

<script>
    // === 1. ìš”ì†Œ ì´ˆê¸°í™” ===
    const workspace = document.getElementById('workspace');
    const container = document.getElementById('preview-container');
    const bgImg = document.getElementById('bg-layer');
    
    // === 2. í™”ë©´ í¬ê¸°ì— ë§ì¶° ìº”ë²„ìŠ¤ ì¶•ì†Œ (ë°˜ì‘í˜• í•µì‹¬) ===
    let currentScale = 1;

    function fitWorkspace() {
        const padding = 20; // ì—¬ë°±
        const availableW = container.clientWidth - padding;
        const availableH = container.clientHeight - padding;
        
        // ê°€ë¡œ/ì„¸ë¡œ ë¹„ìœ¨ ì¤‘ ë” ë§ì´ ì¤„ì—¬ì•¼ í•˜ëŠ” ìª½ ê¸°ì¤€
        const scaleW = availableW / 1280;
        const scaleH = availableH / 720;
        currentScale = Math.min(scaleW, scaleH); // ë” ì‘ì€ ë¹„ìœ¨ ì„ íƒ

        // ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ ì œí•œ (PCì—ì„œ)
        if (currentScale > 1) currentScale = 1; // êµ³ì´ í™•ëŒ€í•˜ì§„ ì•ŠìŒ

        workspace.style.transform = `scale(${currentScale})`;
        
        // CSS transformì€ ê³µê°„ì„ ì°¨ì§€í•˜ë¯€ë¡œ, ë§ˆì§„ì´ë‚˜ ë†’ì´ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ
        // ì—¬ê¸°ì„œëŠ” Flex ì¤‘ì•™ ì •ë ¬ë¡œ ì²˜ë¦¬ë¨.
    }

    window.addEventListener('resize', fitWorkspace);
    // ì´ë¯¸ì§€ ë¡œë“œ ì‹œ ë ˆì´ì•„ì›ƒ ê¹¨ì§ ë°©ì§€ìš© ë”œë ˆì´ ì‹¤í–‰
    setTimeout(fitWorkspace, 100);

    // === 3. ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ ===
    document.getElementById('inp-img').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(evt) {
                bgImg.src = evt.target.result;
                bgImg.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }
    });

    document.getElementById('inp-dim').addEventListener('input', (e) => {
        document.getElementById('overlay-layer').style.opacity = e.target.value;
    });

    // === 4. í…ìŠ¤íŠ¸ ì‹¤ì‹œê°„ ìˆ˜ì • ì—°ê²° ===
    function bindInput(inputId, textId, type) {
        const inp = document.getElementById(inputId);
        const txt = document.getElementById(textId);
        
        inp.addEventListener('input', () => {
            if (type === 'text') txt.innerText = inp.value;
            if (type === 'color') txt.style.color = inp.value;
            if (type === 'bg') txt.style.backgroundColor = inp.value;
            if (type === 'size') txt.style.fontSize = inp.value + 'px';
        });
    }

    bindInput('inp-t1', 't1', 'text');
    bindInput('col-t1', 't1', 'color');
    bindInput('siz-t1', 't1', 'size');

    bindInput('inp-t2', 't2', 'text');
    bindInput('col-t2', 't2', 'color');
    bindInput('bg-t2', 't2', 'bg');


    // === 5. ë“œë˜ê·¸ ë¡œì§ (ëª¨ë°”ì¼ í„°ì¹˜ + PC ë§ˆìš°ìŠ¤ í†µí•©) ===
    let activeItem = null;
    let startX = 0, startY = 0;
    let initialLeft = 0, initialTop = 0;

    const draggables = document.querySelectorAll('.move-text');

    draggables.forEach(item => {
        // PC ë§ˆìš°ìŠ¤
        item.addEventListener('mousedown', startDrag);
        // ëª¨ë°”ì¼ í„°ì¹˜
        item.addEventListener('touchstart', startDrag, { passive: false });
    });

    function startDrag(e) {
        // ê¸°ë³¸ í„°ì¹˜ ë™ì‘(ìŠ¤í¬ë¡¤ ë“±) ë°©ì§€
        if(e.type === 'touchstart') e.preventDefault();
        
        activeItem = this;
        activeItem.classList.add('active'); // í…Œë‘ë¦¬ í‘œì‹œ

        // ì´ë²¤íŠ¸ ì¢Œí‘œ í†µì¼
        const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;

        startX = clientX;
        startY = clientY;

        // í˜„ì¬ style.left/top ê°’ íŒŒì‹± (ì—†ìœ¼ë©´ ì¤‘ì•™ ë°°ì¹˜ëœ computed style ê°€ì ¸ì˜¤ê¸°)
        const rect = activeItem.getBoundingClientRect();
        const parentRect = workspace.getBoundingClientRect();

        // transform:translate(-50%, -50%) ë•Œë¬¸ì— ì˜¤í”„ì…‹ ê³„ì‚°ì´ ë³µì¡í•¨.
        // ë‹¨ìˆœíˆ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ë¸íƒ€ê°’ë§Œ ë”í•´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ê²Œ ì•ˆì „í•¨.
        
        // í˜„ì¬ ìš”ì†Œì˜ CSS left/top ê°’ (px ë‹¨ìœ„ê°€ ì•„ë‹ ìˆ˜ë„ ìˆìŒ)
        // ë“œë˜ê·¸ ì‹œì‘ ì‹œì ì˜ ì ˆëŒ€ ì¢Œí‘œë¥¼ ê¸°ì–µí•˜ì§€ ì•Šê³ , 
        // ì›€ì§ì¸ ê±°ë¦¬ë§Œí¼ì„ ê¸°ì¡´ left/topì— ë”í•´ì£¼ëŠ” ë°©ì‹ ì‚¬ìš©.
        
        // ì´ˆê¸°ê°’ ì„¸íŒ… (ìµœì´ˆ 1íšŒë§Œ % -> px ë³€í™˜ í•„ìš”í•  ìˆ˜ ìˆìŒ)
        // ê°„ë‹¨í•˜ê²Œ: í˜„ì¬ offsetLeft, offsetTopì€ transform ì˜í–¥ ë°›ìŒ.
        // ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•: getBoundingClientRectë¡œ í˜„ì¬ ìº”ë²„ìŠ¤ ë‚´ ì¢Œí‘œ ì—­ì‚°.
        
        // í•˜ì§€ë§Œ ë” ì‰¬ìš´ ë°©ë²•:
        // ê·¸ëƒ¥ í˜„ì¬ ë§ˆìš°ìŠ¤ê°€ ì›€ì§ì¸ ê±°ë¦¬(delta)ë¥¼ scaleë¡œ ë‚˜ëˆ ì„œ í˜„ì¬ style.left/topì— ë”í•¨.
        
        // style.leftê°€ %ì¼ ê²½ìš° pxë¡œ ê°•ì œ ë³€í™˜
        const computed = window.getComputedStyle(activeItem);
        if (activeItem.style.left.includes('%')) {
            activeItem.style.left = computed.left;
            activeItem.style.top = computed.top;
            activeItem.style.transform = 'translate(-50%, -50%)'; // ì¤‘ì‹¬ì  ìœ ì§€
        }

        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchmove', onDrag, { passive: false });
        document.addEventListener('touchend', endDrag);
    }

    function onDrag(e) {
        if (!activeItem) return;
        if(e.type === 'touchmove') e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€

        const clientX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        const clientY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;

        const deltaX = (clientX - startX) / currentScale; // ì¶•ì†Œëœ ë¹„ìœ¨ë§Œí¼ ë³´ì •
        const deltaY = (clientY - startY) / currentScale;

        // í˜„ì¬ ìœ„ì¹˜ ê°’ ê°€ì ¸ì˜¤ê¸° (px)
        let currLeft = parseFloat(activeItem.style.left);
        let currTop = parseFloat(activeItem.style.top);

        activeItem.style.left = (currLeft + deltaX) + 'px';
        activeItem.style.top = (currTop + deltaY) + 'px';

        // ì‹œì‘ì  ì—…ë°ì´íŠ¸
        startX = clientX;
        startY = clientY;
    }

    function endDrag() {
        if (activeItem) {
            activeItem.classList.remove('active');
            activeItem = null;
        }
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('mouseup', endDrag);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('touchend', endDrag);
    }

    // === 6. ì €ì¥ ê¸°ëŠ¥ ===
    function saveImage() {
        // ì €ì¥ ì „ ì„ íƒ í…Œë‘ë¦¬ ì œê±°
        if(activeItem) activeItem.classList.remove('active');
        
        // ìº”ë²„ìŠ¤ ìº¡ì²˜
        html2canvas(workspace, {
            scale: 1, // ì›ë³¸ í¬ê¸°(1280x720)ë¡œ ìº¡ì²˜
            backgroundColor: null,
            useCORS: true
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'thumbnail.jpg';
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();
        });
    }

    // ì´ˆê¸° ì‹¤í–‰
    fitWorkspace();
</script>

</body>
</html>
