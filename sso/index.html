<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Image PLUS - Mobile & Pro</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/YTq2tCG/iconx.webp">
    <style>
        /* í°íŠ¸ ì •ì˜ */
        @font-face {
            font-family: 'LINESeedKR-Bd';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_11-01@1.0/LINESeedKR-Bd.woff2') format('woff2');
            font-weight: 700;
        }
        @font-face {
            font-family: 'RiaSans-ExtraBold';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2410-1@1.0/RiaSans-ExtraBold.woff2') format('woff2');
        }
        @font-face {
            font-family: 'SBAggroB';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SBAggroB.woff') format('woff');
        }

        :root {
            --bg-color: #1d1d1f;
            --panel-bg: #2c2c2e;
            --text-color: #f5f5f7;
            --accent-color: #00ffa3;
            --accent-hover: #00b171;
            --input-bg: #3a3a3c;
            --border-radius: 16px;
        }

        .light-mode {
            --bg-color: #f5f5f7;
            --panel-bg: #ffffff;
            --text-color: #1d1d1f;
            --input-bg: #e5e5e7;
        }

        body {
            font-family: 'LINESeedKR-Bd', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        /* í—¤ë” */
        header {
            width: 100%;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            background-color: var(--panel-bg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        h1 { margin: 0; font-size: 1.2rem; }

        /* ìº”ë²„ìŠ¤ ì˜ì—­ */
        #canvas-wrapper {
            position: relative;
            width: 100%;
            max-width: 960px;
            margin: 20px auto;
            padding: 0 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
        }

        canvas {
            width: 100% !important;
            height: auto !important;
            max-width: 100%;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            touch-action: none; /* í„°ì¹˜ ë“œë˜ê·¸ ì‹œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            cursor: grab;
        }
        canvas:active { cursor: grabbing; }

        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            background: var(--input-bg);
            padding: 5px;
            border-radius: 12px;
        }
        .tab-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            transition: 0.2s;
        }
        .tab-btn.active {
            background-color: var(--bg-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        #controls-container {
            width: 100%;
            max-width: 600px;
            padding: 0 20px 40px 20px;
            box-sizing: border-box;
        }

        .control-group {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            flex-direction: column;
            gap: 15px;
        }
        .control-group.active { display: flex; }

        /* ì…ë ¥ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .input-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .input-label { font-size: 0.9rem; color: #888; }
        
        input[type="text"], input[type="range"] {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background-color: var(--input-bg);
            color: var(--text-color);
            box-sizing: border-box;
            font-family: inherit;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ ì»¤ìŠ¤í…€ */
        .file-btn {
            background-color: var(--input-bg);
            color: var(--text-color);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
            box-sizing: border-box;
            font-weight: bold;
        }
        .file-btn:hover { background-color: #444; }
        .light-mode .file-btn:hover { background-color: #d1d1d1; }

        /* ë©”ì¸ ë²„íŠ¼ */
        .action-btn {
            background-color: var(--accent-color);
            color: #000;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.1s;
        }
        .action-btn:active { transform: scale(0.98); }

        /* í† ê¸€ ë²„íŠ¼ */
        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        /* ë²”ìœ„ ìŠ¬ë¼ì´ë” ì»¤ìŠ¤í…€ */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--accent-color);
            margin-top: -8px;
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #888;
            border-radius: 2px;
        }

        .guide-text {
            font-size: 0.8rem;
            color: #888;
            text-align: center;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 600px) {
            h1 { font-size: 1rem; }
            #controls-container { padding-bottom: 80px; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Image PLUS <span style="font-size:0.8em; opacity:0.7;">Mobile</span></h1>
        <div style="display:flex; gap:10px;">
            <button class="icon-btn" id="toggle-mode">
                <img id="toggle-icon" src="https://navercorp.com/img/common/ic-darkmode.svg" alt="Toggle" width="24" height="24">
            </button>
            <button class="icon-btn" id="redirect-button" style="background:var(--accent-color); border-radius:50%; width:32px; height:32px; display:flex; align-items:center; justify-content:center;">
                <img src="https://www.svgrepo.com/show/532225/table-layout.svg" alt="Link" width="18" height="18">
            </button>
        </div>
    </header>

    <div id="canvas-wrapper">
        <canvas id="thumbnail" width="1920" height="1080"></canvas>
    </div>
    
    <p class="guide-text">ğŸ’¡ í…ìŠ¤íŠ¸ì™€ ë¡œê³ ë¥¼ í„°ì¹˜í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì´ë™í•´ë³´ì„¸ìš”</p>

    <div id="controls-container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('tab-bg')">ë°°ê²½/ë¡œê³ </button>
            <button class="tab-btn" onclick="switchTab('tab-text')">í…ìŠ¤íŠ¸</button>
            <button class="tab-btn" onclick="switchTab('tab-save')">ì €ì¥</button>
        </div>

        <div id="tab-bg" class="control-group active">
            <label class="file-btn">
                ğŸ“¸ ë°°ê²½ ì´ë¯¸ì§€ ì„ íƒ
                <input type="file" id="image-upload" accept="image/*" style="display: none;">
            </label>
            
            <div style="border-top: 1px solid #555; margin: 10px 0;"></div>

            <label class="file-btn">
                ğŸ–¼ï¸ ë¡œê³  ì´ë¯¸ì§€ ì¶”ê°€
                <input type="file" id="logo-upload" accept="image/*" style="display: none;">
            </label>
            
            <div class="input-row">
                <span class="input-label">ë¡œê³  í¬ê¸°</span>
                <input type="range" id="logo-scale" min="0.1" max="2.0" step="0.1" value="1.0">
            </div>
        </div>

        <div id="tab-text" class="control-group">
            <div>
                <span class="input-label">í•˜ë‹¨ ë©”ì¸ í…ìŠ¤íŠ¸ (ìƒ‰ìƒì½”ë“œ: (r),(b),(g),(y),(k))</span>
                <input type="text" id="text-input" placeholder="ì—¬ê¸°ì— í…ìŠ¤íŠ¸ ì…ë ¥">
            </div>
            <div class="input-row">
                <span class="input-label">í¬ê¸°</span>
                <input type="range" id="main-text-size" min="100" max="300" step="10" value="180">
            </div>

            <div style="border-top: 1px solid #555; margin: 10px 0;"></div>

            <div>
                <span class="input-label">ìš°ì¸¡ ìƒë‹¨ í…ìŠ¤íŠ¸ (ë‚ ì§œ ë“±)</span>
                <input type="text" id="top-right-text-input" placeholder="ë‚ ì§œ ì…ë ¥">
            </div>
            <div class="input-row">
                <span class="input-label">í¬ê¸°</span>
                <input type="range" id="sub-text-size" min="50" max="200" step="5" value="100">
            </div>
        </div>

        <div id="tab-save" class="control-group">
            <button id="save-button" class="action-btn">ì´ë¯¸ì§€ë¡œ ì €ì¥ (PNG)</button>
            <button id="compress-button" class="action-btn" style="background-color: #444; color: white; margin-top:0;">ì••ì¶• ì €ì¥ (JPG)</button>
            <div id="file-size-warning" style="color: #ff453a; text-align: center; display: none; margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        // DOM ìš”ì†Œ ì°¸ì¡°
        const canvas = document.getElementById('thumbnail');
        const ctx = canvas.getContext('2d');
        const inputs = {
            mainText: document.getElementById('text-input'),
            subText: document.getElementById('top-right-text-input'),
            logoScale: document.getElementById('logo-scale'),
            mainTextSize: document.getElementById('main-text-size'),
            subTextSize: document.getElementById('sub-text-size')
        };
        
        // ìƒíƒœ ë³€ìˆ˜ (ìœ„ì¹˜, ì´ë¯¸ì§€ ë“± ì €ì¥)
        const state = {
            bgImage: null,
            logoImage: null,
            logo: { x: 40, y: 40, baseWidth: 0, baseHeight: 0, scale: 1.0 },
            mainText: { x: 45, y: 1004, content: "" }, // y = 1080 - 76
            subText: { x: 1500, y: 120, content: "" }, // ì´ˆê¸°ê°’ ì„ì‹œ
            isDragging: null, // 'logo', 'mainText', 'subText' ì¤‘ í•˜ë‚˜
            dragOffset: { x: 0, y: 0 }
        };

        // ì´ˆê¸°í™”
        const today = new Date();
        inputs.subText.value = `${today.getFullYear().toString().slice(2)}.${(today.getMonth() + 1).toString().padStart(2, '0')}.${today.getDate().toString().padStart(2, '0')}`;
        
        // ì´ˆê¸° ê·¸ë¦¬ê¸°
        drawCanvas();

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

        // 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ
        document.getElementById('image-upload').addEventListener('change', (e) => loadFile(e.target.files[0], 'bg'));
        document.getElementById('logo-upload').addEventListener('change', (e) => loadFile(e.target.files[0], 'logo'));

        function loadFile(file, type) {
            if (!file) return;
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = () => {
                if (type === 'bg') {
                    state.bgImage = img;
                } else {
                    state.logoImage = img;
                    // ë¡œê³  ì´ˆê¸° í¬ê¸° ê³„ì‚° (ìµœëŒ€ 300px ì œí•œ ë¡œì§ ìœ ì§€)
                    const maxDim = 300;
                    const aspect = img.width / img.height;
                    if (img.width > maxDim || img.height > maxDim) {
                        if (aspect > 1) {
                            state.logo.baseWidth = maxDim;
                            state.logo.baseHeight = maxDim / aspect;
                        } else {
                            state.logo.baseHeight = maxDim;
                            state.logo.baseWidth = maxDim * aspect;
                        }
                    } else {
                        state.logo.baseWidth = img.width;
                        state.logo.baseHeight = img.height;
                    }
                }
                drawCanvas();
            };
            img.src = URL.createObjectURL(file);
        }

        // 2. ì…ë ¥ ê°’ ë³€ê²½ ê°ì§€
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', () => {
                state.logo.scale = parseFloat(inputs.logoScale.value);
                drawCanvas();
            });
        });

        // 3. íƒ­ ì „í™˜ ê¸°ëŠ¥
        window.switchTab = (tabId) => {
            document.querySelectorAll('.control-group').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        };

        // 4. ë“œë˜ê·¸ ì•¤ ë“œë¡­ (ë§ˆìš°ìŠ¤ + í„°ì¹˜)
        const getPointerPos = (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            let clientX = e.clientX;
            let clientY = e.clientY;

            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            }

            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        };

        const handleStart = (e) => {
            const pos = getPointerPos(e);
            
            // í´ë¦­ íˆíŠ¸ í…ŒìŠ¤íŠ¸ (Hit Test)
            // 1. ë¡œê³  í™•ì¸
            if (state.logoImage) {
                const w = state.logo.baseWidth * state.logo.scale;
                const h = state.logo.baseHeight * state.logo.scale;
                if (pos.x >= state.logo.x && pos.x <= state.logo.x + w &&
                    pos.y >= state.logo.y && pos.y <= state.logo.y + h) {
                    state.isDragging = 'logo';
                    state.dragOffset = { x: pos.x - state.logo.x, y: pos.y - state.logo.y };
                    return;
                }
            }

            // 2. ë©”ì¸ í…ìŠ¤íŠ¸ í™•ì¸ (ëŒ€ëµì ì¸ ë†’ì´ ê°€ì •)
            const mainSize = parseInt(inputs.mainTextSize.value);
            // ë©”ì¸ í…ìŠ¤íŠ¸ëŠ” baselineì´ í•˜ë‹¨ì´ë¯€ë¡œ yê°’ ìœ„ìª½ìœ¼ë¡œ ì˜ì—­ ì¡ìŒ
            if (pos.y <= state.mainText.y && pos.y >= state.mainText.y - mainSize) {
                // ê°„ë‹¨í•œ X ë²”ìœ„ ì²´í¬ (ì •í™•í•œ width ê³„ì‚° ëŒ€ì‹  í™”ë©´ ì „ì²´ í—ˆìš©í•˜ë˜ ê·¼ì²˜ì¼ ë•Œ)
                if (pos.x >= state.mainText.x - 50 && pos.x <= canvas.width) {
                    state.isDragging = 'mainText';
                    state.dragOffset = { x: pos.x - state.mainText.x, y: pos.y - state.mainText.y };
                    return;
                }
            }

            // 3. ì„œë¸Œ í…ìŠ¤íŠ¸ í™•ì¸
            const subSize = parseInt(inputs.subTextSize.value);
            // ì„œë¸Œ í…ìŠ¤íŠ¸ë„ ë¹„ìŠ·í•˜ê²Œ ì²˜ë¦¬ (ëŒ€ëµì  ì˜ì—­)
            if (pos.y <= state.subText.y && pos.y >= state.subText.y - subSize) {
                 if (pos.x <= state.subText.x + 500 && pos.x >= state.subText.x - 500) { // ë„“ê²Œ ì¡ìŒ
                    state.isDragging = 'subText';
                    state.dragOffset = { x: pos.x - state.subText.x, y: pos.y - state.subText.y };
                    return;
                }
            }
        };

        const handleMove = (e) => {
            if (!state.isDragging) return;
            e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
            const pos = getPointerPos(e);

            if (state.isDragging === 'logo') {
                state.logo.x = pos.x - state.dragOffset.x;
                state.logo.y = pos.y - state.dragOffset.y;
            } else if (state.isDragging === 'mainText') {
                state.mainText.x = pos.x - state.dragOffset.x;
                state.mainText.y = pos.y - state.dragOffset.y;
            } else if (state.isDragging === 'subText') {
                state.subText.x = pos.x - state.dragOffset.x;
                state.subText.y = pos.y - state.dragOffset.y;
            }
            drawCanvas();
        };

        const handleEnd = () => {
            state.isDragging = null;
        };

        canvas.addEventListener('mousedown', handleStart);
        canvas.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', handleEnd);
        
        canvas.addEventListener('touchstart', handleStart, { passive: false });
        canvas.addEventListener('touchmove', handleMove, { passive: false });
        window.addEventListener('touchend', handleEnd);


        // --- ê·¸ë¦¬ê¸° ë¡œì§ ---
        function drawCanvas() {
            // ë°°ê²½ ì´ˆê¸°í™”
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg-color');
            
            // 1. ë°°ê²½ ì´ë¯¸ì§€
            if (state.bgImage) {
                ctx.drawImage(state.bgImage, 0, 0, canvas.width, canvas.height);
            } else {
                ctx.fillStyle = '#333';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                // ë°ëª¨ìš© í”Œë ˆì´ìŠ¤í™€ë” í…ìŠ¤íŠ¸
                ctx.font = 'bold 100px sans-serif';
                ctx.fillStyle = '#555';
                ctx.textAlign = 'center';
                ctx.fillText('ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ì„¸ìš”', canvas.width/2, canvas.height/2);
            }

            // 2. ë¡œê³ 
            if (state.logoImage) {
                const w = state.logo.baseWidth * state.logo.scale;
                const h = state.logo.baseHeight * state.logo.scale;
                ctx.drawImage(state.logoImage, state.logo.x, state.logo.y, w, h);
                
                // ì„ íƒ í‘œì‹œ (ë“œë˜ê·¸ ì¤‘ì¼ ë•Œ)
                if(state.isDragging === 'logo') {
                    ctx.strokeStyle = '#00ffa3';
                    ctx.lineWidth = 4;
                    ctx.strokeRect(state.logo.x, state.logo.y, w, h);
                }
            }

            // 3. ë©”ì¸ í…ìŠ¤íŠ¸ (ì¢Œì¸¡ í•˜ë‹¨)
            const mainTextVal = inputs.mainText.value;
            if (mainTextVal) {
                const size = inputs.mainTextSize.value;
                ctx.font = `bold ${size}px SBAggroB`;
                ctx.textAlign = 'left';
                ctx.strokeStyle = 'black';
                ctx.lineWidth = size * 0.03; // í°íŠ¸ í¬ê¸°ì— ë¹„ë¡€í•œ ì™¸ê³½ì„ 

                let startX = state.mainText.x;
                const startY = state.mainText.y;
                
                const parts = mainTextVal.split(/(\(r\).*?\(r\)|\(g\).*?\(g\)|\(b\).*?\(b\)|\(y\).*?\(y\)|\(k\).*?\(k\))/);

                parts.forEach(part => {
                    let color = 'white';
                    let text = part;
                    
                    if (part.match(/^\(.\).*\(.\)$/)) {
                        text = part.slice(3, -3);
                        if (part.startsWith('(r)')) color = '#ff0000';
                        else if (part.startsWith('(g)')) color = '#00ffa3e6';
                        else if (part.startsWith('(b)')) color = '#153cff';
                        else if (part.startsWith('(y)') && part.endsWith('(y)')) color = '#ffdb4d'; // ë…¸ë‘
                        else if (part.startsWith('(k)') && part.endsWith('(k)')) color = '#1d1d1d'; // ê²€ì •
                    }

                    ctx.fillStyle = color;
                    ctx.strokeText(text, startX, startY);
                    ctx.fillText(text, startX, startY);
                    startX += ctx.measureText(text).width;
                });
                
                // ë“œë˜ê·¸ ê°€ì´ë“œ
                if(state.isDragging === 'mainText') {
                    ctx.fillStyle = 'rgba(0, 255, 163, 0.3)';
                    ctx.fillRect(state.mainText.x - 10, startY - size, startX - state.mainText.x + 20, parseInt(size) + 20);
                }
            }

            // 4. ì„œë¸Œ í…ìŠ¤íŠ¸ (ìš°ì¸¡ ìƒë‹¨)
            const subTextVal = inputs.subText.value;
            if (subTextVal) {
                const size = inputs.subTextSize.value;
                ctx.font = `bold ${size}px RiaSans-ExtraBold`;
                // ì›ë³¸ ë¡œì§ ìœ ì§€: ìš°ì¸¡ ì •ë ¬ ëŠë‚Œì„ ìœ„í•´ í…ìŠ¤íŠ¸ ì „ì²´ ê¸¸ì´ë¥¼ ê³„ì‚°í•˜ê³  xì—ì„œ ëºŒ
                // í•˜ì§€ë§Œ ë“œë˜ê·¸ ê¸°ëŠ¥ì„ ìœ„í•´ state.subText.xë¥¼ 'ëì 'ìœ¼ë¡œ ì„¤ì •í•˜ê±°ë‚˜ 'ì‹œì‘ì 'ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•¨.
                // ì—¬ê¸°ì„œëŠ” state.subText.xë¥¼ í…ìŠ¤íŠ¸ì˜ "ì˜¤ë¥¸ìª½ ë" ì¢Œí‘œë¡œ í™œìš©í•˜ì—¬ ì›ë³¸ ë¡œì§ì˜ ìœ„ì¹˜(canvas.width - 46)ë¥¼ ëª¨ë°©í•¨.
                
                // ìš°ì¸¡ ìƒë‹¨ í…ìŠ¤íŠ¸ëŠ” "ìš°ì¸¡ ì •ë ¬"ì´ ê¸°ë³¸ì´ë¯€ë¡œ, 
                // ì´ˆê¸°ê°’ state.subText.x ê°€ canvas.width - 46 ì •ë„ë¡œ ì„¤ì •ë¨.
                if (state.subText.x > 1400 && state.isDragging === null && state.subText.x === 1500) {
                     // ì²« ë Œë”ë§ ì‹œ ìœ„ì¹˜ ë³´ì •
                     state.subText.x = canvas.width - 46; 
                }

                const parts = subTextVal.split(/(\(r\).*?\(r\)|\(g\).*?\(g\)|\(b\).*?\(b\)|\(y\).*?\(y\)|\(k\).*?\(k\))/);
                
                // ì „ì²´ ê¸¸ì´ ê³„ì‚°
                let totalWidth = 0;
                parts.forEach(part => {
                    let text = part;
                    if (part.match(/^\(.\).*\(.\)$/)) text = part.slice(3, -3);
                    totalWidth += ctx.measureText(text).width;
                });

                // ê·¸ë¦¬ê¸° ì‹œì‘ì  (ì˜¤ë¥¸ìª½ ê¸°ì¤€ì¢Œí‘œ - ì „ì²´ë„ˆë¹„)
                let drawX = state.subText.x - totalWidth;
                const drawY = state.subText.y;

                ctx.textAlign = 'left';
                ctx.lineWidth = size * 0.03;

                parts.forEach(part => {
                    let color = 'white';
                    let text = part;
                    if (part.match(/^\(.\).*\(.\)$/)) {
                        text = part.slice(3, -3);
                        if (part.startsWith('(r)')) color = '#ff0000';
                        else if (part.startsWith('(g)')) color = '#00ffa3e6';
                        else if (part.startsWith('(b)')) color = '#3f8bff';
                        else if (part.startsWith('(y)') && part.endsWith('(y)')) color = '#ffdb4d'; 
                        else if (part.startsWith('(k)') && part.endsWith('(k)')) color = '#1d1d1d';
                    }

                    ctx.strokeStyle = 'black';
                    ctx.fillStyle = color;
                    ctx.strokeText(text, drawX, drawY);
                    ctx.fillText(text, drawX, drawY);
                    drawX += ctx.measureText(text).width;
                });

                // ë“œë˜ê·¸ ê°€ì´ë“œ
                if(state.isDragging === 'subText') {
                    ctx.fillStyle = 'rgba(0, 255, 163, 0.3)';
                    ctx.fillRect(state.subText.x - totalWidth - 10, drawY - size, totalWidth + 20, parseInt(size) + 20);
                }
            }
        }


        // --- ìœ í‹¸ë¦¬í‹° ê¸°ëŠ¥ ---
        
        // ë‹¤í¬ ëª¨ë“œ í† ê¸€
        document.getElementById('toggle-mode').addEventListener('click', () => {
            const root = document.documentElement;
            root.classList.toggle('light-mode');
            const icon = document.getElementById('toggle-icon');
            if (root.classList.contains('light-mode')) {
                icon.src = 'https://navercorp.com/img/common/ic-darkmode-on.png';
            } else {
                icon.src = 'https://navercorp.com/img/common/ic-lightmode-w.svg';
            }
            drawCanvas();
        });

        // ë¦¬ë‹¤ì´ë ‰íŠ¸
        document.getElementById('redirect-button').addEventListener('click', () => {
            window.location.href = 'https://jisungeda55.github.io/imageplus/imagex';
        });

        // ì €ì¥ ê¸°ëŠ¥
        const downloadFile = (blob, ext) => {
            const link = document.createElement('a');
            const now = new Date();
            const timeString = `${now.getFullYear().toString().slice(2)}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;
            link.download = `${timeString}.${ext}`;
            link.href = URL.createObjectURL(blob);
            link.click();
        };

        document.getElementById('save-button').addEventListener('click', () => {
            drawCanvas();
            canvas.toBlob((blob) => {
                downloadFile(blob, 'png');
            }, 'image/png');
        });

        document.getElementById('compress-button').addEventListener('click', () => {
            drawCanvas();
            // ê°„ë‹¨ ì••ì¶• ë¡œì§ (í€„ë¦¬í‹° 0.8)
            canvas.toBlob((blob) => {
                const mb = (blob.size / 1024 / 1024).toFixed(2);
                const warning = document.getElementById('file-size-warning');
                warning.style.display = 'block';
                warning.textContent = `ì••ì¶• ì €ì¥ ì™„ë£Œ: ${mb}MB`;
                downloadFile(blob, 'jpg');
            }, 'image/jpeg', 0.8);
        });

    </script>
</body>
</html>
